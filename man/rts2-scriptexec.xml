<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE refentry PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN"
"http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd" [

  <!ENTITY dhfirstname "<firstname>Petr</firstname>">
  <!ENTITY dhsurname   "<surname>Kubanek</surname>">
  <!ENTITY dhdate      "<date>2009-07-05</date>">
  <!ENTITY dhsection   "<manvolnum>1</manvolnum>">
  <!ENTITY dhemail     "<email>petr@kubanek.net</email>">
  <!ENTITY dhusername  "Petr Kubanek">
  <!ENTITY dhpackage   "rts2-scriptexec">

  <!ENTITY gnu         "<acronym>GNU</acronym>">
  <!ENTITY gpl         "&gnu; <acronym>GPL</acronym>">
]>

<refentry>
  <refentryinfo>
    <title>&dhpackage;</title>
    <productname>rts2</productname>
    <productnumber>0.8.0</productnumber>
    &dhdate;
    <authorgroup>
      <author>
        &dhfirstname;
        &dhsurname;
	<contrib>Wrote most of the RTS2 package.</contrib>
	<address>
          &dhemail;
	</address>
      </author>
    </authorgroup>
    <copyright>
      <year>2007-2010</year>
      <holder>&dhusername;</holder>
    </copyright>
    <legalnotice>
      <para>
	This manual page was written by &dhusername; &dhemail;.  Permission is
	granted to copy, distribute and/or modify this document under the terms
	of the &gnu; General Public License, Version 2 any later version
	published by the Free Software Foundation.
      </para>
    </legalnotice>
  </refentryinfo>
  <refmeta>
    <refentrytitle>&dhpackage;</refentrytitle>
    &dhsection;
  </refmeta>
  <refnamediv>
    <refname>&dhpackage;</refname>
    <refpurpose>Allow execution of the script(s) on device(s).</refpurpose>
  </refnamediv>
  <refsynopsisdiv>
    <cmdsynopsis>
      <command>&dhpackage;</command>
      <arg choice="opt">
        <arg choice="plain"><option>-h</option></arg>
	<arg choice="plain"><option>--help</option></arg>
      </arg>
      <arg choice="opt">
	<arg choice="plain"><option>--version</option></arg>
      </arg>
      <arg choice="opt">
	<arg choice="plain"><option>--config <replaceable>config file</replaceable></option></arg>
      </arg>
      <arg choice="opt">
        <arg choice="plain"><option>-d</option> <replaceable>device name</replaceable></arg>
      </arg>
      <arg choice="opt">
        <arg choice="plain"><option>-s</option> <replaceable>script</replaceable></arg>
      </arg>
      <arg choice="opt">
        <arg choice="plain"><option>-S</option> <replaceable>script</replaceable></arg>
      </arg>
      <arg choice="opt">
        <arg choice="plain"><option>-e</option> <replaceable>expand string</replaceable></arg>
      </arg>
    </cmdsynopsis>
  </refsynopsisdiv>

  <refsect1 id="description">
    <title>DESCRIPTION</title>

    <para>
      <command>&dhpackage;</command> enables execution of different scripts on
      the specified devices. It is dedicated for users who wish to run scripts on devices without 
      supporting infrastructure of the 
    <citerefentry><refentrytitle>rts2-executor</refentrytitle><manvolnum>1</manvolnum></citerefentry>.
      Please note that as synchronization is handled on RTS2 system level, by
      running rts2-scriptexec you will still benefit from same synchronizations
      locks which rts2-executor uses. Running script under rts2-scriptexec is
      equvivalent to running script from target send to rts2-executor.
    </para>
    <para>
      The default behaviour is to write list of created files to standard
      output. Standard error output receives debugging messages. Files are
      written to standard output after they are saved to disk and so its save
      to use them.
    </para>
  </refsect1>
  <refsect1 id="options">
    <title>OPTIONS</title>

    <para>
      This program follows the usual &gnu; command line syntax,
      with long options starting with two dashes (`--').  A summary of
      options is included below.
    </para>

    <variablelist>
      <varlistentry>
        <term><option>-h</option></term>
        <term><option>--help</option></term>
        <listitem>
          <para>Show summary of options.</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><option>--version</option></term>
        <listitem>
          <para>Show version of the program.</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><option>--config <replaceable class="parameter">config-file</replaceable></option></term>
        <listitem>
          <para>Specify configuration file. defaults to <filename>/etc/rts2/rts2.ini</filename>.</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><option>-d <replaceable class="parameter">device name</replaceable></option></term>
        <listitem>
          <para>
	    Specify a device that will be used. The most common one is "C0", for
	    the main camera. Check
	    <citerefentry><refentrytitle>rts2-mon</refentrytitle><manvolnum>1</manvolnum></citerefentry>
	    for a list of the devices that are present in your setup.
	  </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><option>-s <replaceable class="parameter">script</replaceable></option></term>
        <listitem>
          <para>
	    Specify script that will be executed. This option MUST be preceeded
	    with <option>-d</option> option. For details of the script syntax,
	    please see
	    <citerefentry><refentrytitle>rts2.script</refentrytitle><manvolnum>5</manvolnum></citerefentry>.
	  </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><option>-S <replaceable class="parameter">script</replaceable></option></term>
        <listitem>
          <para>
	    Similar to -s, but does not call script_ends before executing the
	    script - does not reset device to default configuration.
	  </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><option>-e <replaceable class="parameter">expand string</replaceable></option></term>
        <listitem>
          <para>
	    Specify path on which images will be saved. Path is constitued as expression, described in 
	    <citerefentry><refentrytitle>rts2.ini</refentrytitle><manvolnum>5</manvolnum></citerefentry>.
	  </para>
        </listitem>
      </varlistentry>
    </variablelist>
  </refsect1>
  <refsect1>
    <title>Configuration file</title>
    <para>
      Configuration file can be specified with --config option. If this option is not used, default configuration file (ussually /etc/rts2/rts2.ini) is used. Following options can
      be specified in configuration file <emphasis role="bold">scriptexec</emphasis> section.
    </para>
    <variablelist>
      <varlistentry>
        <term>expand_path</term>
	<listitem>
	  <para>
	    Specify expand path for images produced by <emphasis role="bold">&dhpackage;</emphasis>. This path can be override with
	    -e parameter. For details about possible path strings, please see
	    <citerefentry><refentrytitle>rts2.ini</refentrytitle><manvolnum>5</manvolnum></citerefentry>.
	  </para>
	</listitem>
      </varlistentry>
      <varlistentry>
        <term>default_device</term>
	<listitem>
	  <para>
	    Set default device. This is used if -d option is not set.
	  </para>
	</listitem>
      </varlistentry>
    </variablelist>
  </refsect1>
  <refsect1>
    <title>COMMAND OUTPUT</title>

    <para>
      Output goes to standard output and it consists of logging messages from the application.
    </para>

  </refsect1>
  <refsect1>
    <title>EXAMPLES</title>

    <para>
      The following example will execute simple script that takes 10 times 5 and 10 second exposures using device C0.
    </para>

    <screen>
      <command>&dhpackage;</command> <option>-d</option> <replaceable>C0</replaceable> <option>-s</option> <replaceable>'for 10 { E 5 E 10 }'</replaceable>
    </screen>

    <para>
      Following command will save images in local time, prefixed with camera name:
    </para>

    <screen>
      <command>&dhpackage;</command> <option>-e</option> <replaceable>'%c_%L%f'</replaceable> <option>-d</option> <replaceable>C0</replaceable> <option>-s</option> <replaceable>'for 10 { E 5 E 10 }'</replaceable>
    </screen>

    <para>
      And the following will (in bash/sh) ship images to ds9 via xpa, as soon as they are acquired:
    </para>

    <screen>
      while true; do <command>&dhpackage;</command> <option>-d</option> <replaceable>C0</replaceable> <option>-s</option> <replaceable>'for 1000 { E 1 }'</replaceable> | while read x; do xpaset ds9 fits &lt; $x; done ; done
    </screen>

  </refsect1>    
  <refsect1>
    <title>SEE ALSO</title>

    <para>
      <citerefentry>
        <refentrytitle>rts2</refentrytitle>
	<manvolnum>7</manvolnum>
      </citerefentry>
      <citerefentry>
        <refentrytitle>rts2.script</refentrytitle>
	<manvolnum>5</manvolnum>
      </citerefentry>
      <citerefentry>
        <refentrytitle>rts2.ini</refentrytitle>
	<manvolnum>5</manvolnum>
      </citerefentry>
    </para>

  </refsect1>
</refentry>
