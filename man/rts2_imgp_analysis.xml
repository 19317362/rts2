<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE refentry PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN" "http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd" [

  <!ENTITY dhfirstname "<firstname>Markus</firstname>">
  <!ENTITY dhsurname   "<surname>Wildi</surname>">
  <!ENTITY dhdate      "<date>2012-07-03</date>">
  <!ENTITY dhsection   "<manvolnum>1</manvolnum>">
  <!ENTITY dhemail     "<email>markus.wildi@one-arcsec.org</email>">
  <!ENTITY dhusername  "Markus Wildi">
  <!ENTITY dhpackage   "rts2_imgp_analysis">

  <!ENTITY % rts2 SYSTEM "rts2.ent">
  %rts2;
]>

<refentry>
  <refentryinfo>
    <title>&dhpackage;</title>
    <productname></productname>
    <productnumber>&rts2version;</productnumber>
    &dhdate;
    <authorgroup>
      <author>
        &dhfirstname;
        &dhsurname;
	<contrib></contrib>
	<address>
          &dhemail;
	</address>
      </author>
    </authorgroup>
    <copyright>
      <year>2012</year>
      <holder>&dhusername;</holder>
    </copyright>
    <legalnotice>
      <para>
	This manual page was written by &dhusername; &dhemail;.  Permission is
	granted to copy, distribute and/or modify this document under the terms
	of the &gnu; General Public License, Version 2 or any later versions
	published by the Free Software Foundation.
      </para>
    </legalnotice>
  </refentryinfo>
  <refmeta>
    <refentrytitle>&dhpackage;</refentrytitle>
    &dhsection;
  </refmeta>
  <refnamediv>
  <refname>&dhpackage;</refname>
    <refpurpose>  
     find image center coordinates and maintain focal plane.</refpurpose>
  </refnamediv>
  <refsynopsisdiv>
    <cmdsynopsis>
<!-- murks:      <command>&dhpackage;</command>-->
<arg choice="plain"><option>imgp_analysis.py <replaceable>/path/to/fits/file</replaceable></option></arg>
      
<!--	<arg choice="plain"><option>[OPTIONS] \-\-config <replaceable>configuration_file</replaceable></option></arg>
-->
    </cmdsynopsis>

  </refsynopsisdiv>
<refsect1><title>Dependencies</title>  
    <para> &dhpackage; depends on the following packages</para>

    <variablelist>   
        <varlistentry>
        <term><command>SExtractor</command> measures FWHM, flux and associates objects on all images.</term> 
        </varlistentry>
        <varlistentry>
        <term><command>astrometry.net</command> is used by
<command>rts2-astrometry.net</command> to find the center of the image.</term> 
        </varlistentry>
    </variablelist>   
  </refsect1>
  <refsect1 id="options">
    <title>OPTIONS</title>
    <para>
<command>imgp_analysis.py</command> has no options.
    </para>
  </refsect1>

<refsect1><title>Optional programs</title>  
    <para><command>rts2af</command> family scripts support <command>ds9</command>.</para>
    <variablelist>   
      <varlistentry>
      <term>After a focal plane analysis has been carried out a bash script is generated to view all objects as ds9 regions on all images. ds9 is the recommended tool for debugging.</term>
       </varlistentry>
    </variablelist>   
  </refsect1>
  <refsect1>
    <title>Limitations</title>
    <para>The default values of the parameters have been determined with
    a refractor that has a focal ratio of f/7 and the CCD which provided a field
    of view  of 1.6 deg2. It might be that SExtractor fails if a reflector
    is used at positions far from best focus.
    </para>
 </refsect1>
  <refsect1>
    <title>Overview online analysis process</title>
    <para>The following scripts reside in subdirectories scripts or scripts/rts2af.</para>
    <variablelist>   
      <varlistentry>
    	<term>Configured in /etc/rts2/rts2.ini <command>imgp_analysis.py</command>
is called by IMGP and spawns processes
<command>rts2af_fwhm.py</command> and <command>rts2-astrometry.net</command> in
parallel to define the FWHM  and the astrometric
calibration.</term>
      </varlistentry>
      <varlistentry>
      <term><command>rts2-astrometry.net</command> calls solve-field
(astrometry.net) and returns
the corrections to IGMP.</term>
      </varlistentry>
      <varlistentry>
      <term><command>rts2af_fwhm.py</command> triggers an on target focus run
if FWHM is above threshold.</term>
      </varlistentry>
      <varlistentry>
      <term><command>rts2af-queue</command> is called by
<command>rts2af_fwhm.py</command> and queues target with tar_id 5
(OnTargetFocus) into queue named focusing.</term>
      </varlistentry>
       <varlistentry>
      <term><command>rts2af_acquire.py</command> is specified as script for
target with tar_id 5 (OnTargetFocus). It steers CCD, focuser and filter wheel.</term>
      </varlistentry>
      <varlistentry>
      <term><command>rts2af_analysis.py</command> is called by
<command>rts2af_acquire.py</command> and performs the analysis and comparison
of the images.</term>
      </varlistentry>
      <varlistentry>
      <term><command>rts2af_fit.py</command>, is called by
<command>rts2af_analysis.py</command> and fits the focus.</term>
      </varlistentry>
      <varlistentry>
      <term><command>rts2af_offline.py</command> is used to analyze a set of previously taken focus images.</term>
      </varlistentry>
      <varlistentry>
      <term><command>rts2af_feedback_acquire.py</command> is used to test
<command>rts2af_acquire.py</command> during daytime or when no real images are available.</term>
      </varlistentry>
      <varlistentry>
      <term>All other programs in directory scripts/rts2af one can be safely ignored.</term>
      </varlistentry>
    </variablelist>   
</refsect1>

<refsect1>
<title>Autonomous operation</title>
<para>
<command>imgp_analysis.py</command> must be defined in rts2.ini section [imgproc] 
by variable astrometry. This script is called whenever an image has been stored on 
disk. <command>rts2af_fwhm.py</command> evaluates the FWHM and if it is above a 
configurable threshold <command>rts2af-queue</command> queues target with tar_id 5 
in RTS2 selector`s queue named focusing. <command>rts2af_acquire.py</command> 
is defined in the database table named scripts with tar_id 5.
<command>rts2af_acquire.py</command> performs online data taking, it steers the 
CCD camera and its associated focuser and filter wheel if  present. It
passes the image file names to <command>rts2af_analysis.py</command>. After FWHM
and flux have been determined <command>rts2af_analysis.py</command> calls
 <command>rts2af_fit.py</command>. If the fit has converged, the focus
position FOC_DEF is set by <command>rts2af_acquire.py</command>. FOC_DEF is
only set for measurements without filter (clear path). For each specified filter
a separate focus run is carried out supporting fast filter focus offset measurements.
Filter focus offsets, that is the difference between focus position of a given
filter minnus FOC_DEF, can be used as  parameters for any rts2-camd-* driver
in file /etc/rts2/devices.
</para>
<para>In case the fit does not converge with the matching SExtractor objects,
then a second fit is performed with any object which have a flag 0.
If this fails too the weighted mean ins calculated for FWHM and flux. If they
agree  within FOCUSER_RESOLUTION the average of both is used to set FOC_DEF.
In the rare case an error occurs during weighted mean calculation the extrme
of FWHM and flux are used (experimental feature).
</para></refsect1>
<refsect1>
<title>Background</title>
<para>During autonomous operation the first image taken is considered as
reference and named as *_reference.fits. This image must be taken near focus
since its by SExtractor identified objects will be searched on any other
image. For that purpose SExtractor rereads the reference catalog ("sky list") 
and compares the x,y positions, but not the brightness, with those from the 
current image. The configuration of the filter properties, namely
lower and upper limit of focus travel as well as step size, define
how the focus run is carried out. The focuser is positioned at FOC_DEF minus
lower limit, then an image is taken and asynchronously analyzed, while the
focuser travels to next position until upper limit is reached. After all
images are analyzed the resulting values for FWHM and flux are written to 
files and the fit program is started. The extreme, the minimum of FWHM and the
maximum of flux, are independently fitted and  define the focus.  
</para>

<para>
The reference catalog can be cleaned up meaning that objects which carry
a SExtractor flag other than 0 as well as close groups of objects are removed.
This is the default behavior.
</para> 
<para>
During analysis DS9 region of interest (*.reg) files are written for
each image. These files can be loaded with DS9 and inspected.  The circle is
centered to SExtractor`s x,y positions. Red circles indicate objects without a
match, blue circles
indicate that an object has been identified by comparing it against the
reference catalog, yellow circles are present in the reference image, while green circles mark
objects present on all images and
hence chosen for analysis. Merging all files together 
gives a first idea of SExtractor`s selection.  For your convenience a bash
script is generated to view all objects as ds9 regions on all images (see movie
with mplayer -xy 2. -speed 0.2 http://azug.minpet.unibas.ch/~wildi/vermes/ds9-rts2-autofocus-object-358.mpeg).
</para>
<para>
The output of the fit program is stored as a PNG file and optionally
displayed on screen. If the process is accessed remotely the X-Window DISPLAY 
variable has to be set otherwise the fit process will not stop. This mode
is not recommended during autonomous operation. The essential results are 
written to a file.
</para> 
<!--
<para>
ToDo: verify that: Depending on the argument of AUTO_FOCUS, it can be either False or True, a one
or two pass analysis is carried out. In the former case a
reference image (reference catalog) is taken near the assumed best focus defined in
filter properties. In the latter case first a estimated focus is
determined  simply based on
how many objects SExtractor identifies. A weighted mean is calculated
and the value is set.
After this first pass a series of images are taken centered around the mean in
online mode while in
offline mode the given set of images is analyzed  centred around the mean.
The fits images are renamed in online mode after the first pass and get the
extension
AUTO_FOCUS_RUN_EXTENSION.
</para>
-->
<!--
    <para>
     The selection of the objects is done in sub raw_analysis(\@){}. The 
defined selection is based solely on properties of the reference
catalog. Feel free to add more criteria as long as you get enough objects.
    </para>
-->
<para>Fits header key words FILTER,BINNING, NAXIS1, NAXIS2, ORIRA and ORIDEC
are compared against the reference file and an image is rejected in case they do not match. This is important in case of offline analysis, during autonomous operation all header elements are equal.
</para>    
</refsect1>
  <refsect1 id="values">
    <title>PARAMETERS, VALUES</title>
    <para>
The following parameters are elements of the configuration file.
If a parameter does not appear in the configuration file, the
default value is used. The format of the following list is parameter name, "data type", default value.</para>
    <varlistentry>
    <term>
    <option>filter properties</option>
    </term>
    <listitem>
    <para>The following properties are defined for U, B, V, R, I, X, Y and NOFILTER as defaults: </para>
      <varlistentry>
	<term>FILTER_NAME, string, U,B,V,R,I,...
         </term>
      </varlistentry> 
      <varlistentry>
	<term>Filter offset, int, 1074, 1712,  1678, 1766,  1700, 270, 446
         </term>
	<listitem>0 for no filter.<para></para>
        </listitem>
 </varlistentry> 
      <varlistentry>
	<term>LOWER_LIMIT, int -1500 [ticks]
         </term>
	<listitem><para>Lower limit 
       relative to FOC_DEF.</para>
        </listitem>
 </varlistentry> 
      <varlistentry>
	<term>UPPER_LIMIT, int, 1500 [ticks]
         </term>
	<listitem><para>Upper limit relative to FOC_DEF.</para>
        </listitem>
 </varlistentry> 
      <varlistentry>
	<term>STEP_SIZE, int, 100 [ticks]
         </term>
	<listitem><para>Focuser step size.</para>
        </listitem>
 </varlistentry> 
      <varlistentry>
	<term>EXPOSURE_FACTOR, float, 1.
         </term>
	<listitem><para>Exposure factor used for the filter. This factor is
multiplied by DEFAULT_EXPOSURE.</para>
        </listitem>
 </varlistentry> 
 </listitem> 
<para> NOFILTER is a special entry for the case where no filter wheel is present. It`s
properties are defined in the same way as described above.
</para>
</varlistentry>

      <varlistentry>
	<term><option>NOT implemented: AUTO_FOCUS, boolean, True</option>
         </term>
	<listitem><para>If set True <command>rts2af</command> takes images
over the whole range of FOCUSER_ABSOLUTE_LOWER_LIMIT and
FOCUSER_ABSOLUTE_UPPER_LIMIT and calculates a weighted mean based on the number
of objects SExtractor identifies on each image. </para>
        </listitem>
 </varlistentry>
      <varlistentry>
	<term>
      <option>BASE_DIRECTORY, file name, "/scratch/focus/"</option>
          </term>
	<listitem>
	  <para>
             In offline mode BASE_DIRECTORY denotes the path to the subdirectories where the fits files were stored in the form BASE_DIRECTORY/filter. In online mode it is the
             base path where subdirectories of the form date-time/filter, e.g. 2010-03-15T17:54:01/U, will be created.
          </para>
	</listitem>
      </varlistentry>

    <varlistentry>
    <term>
    <option>CCD_BINNING, int,  1 (2x2 for the FLI CCD)</option>
    </term>
    <listitem>
    <para> To avoid huge amounts of data set the binning according to your needs. 
           Check the appropriate values with the camera driver.
    </para>
    </listitem>
    </varlistentry>

    <varlistentry>
    <term>
    <option>CCD_CAMERA, string, "CD"</option>
    </term>
    <listitem>
    <para>This device and its associated focuser and filter wheel are chosen.
    </para>
    </listitem>
    </varlistentry>

    <varlistentry>
    <term>
    <option>CCD_WINDOW, e.g. -1 -1 -1 -1 for full frame</option>
    </term>
    <listitem>
    <para> Follows RTS2 script syntax.
    </para>
    </listitem>
    </varlistentry>

   <varlistentry>
    <term>
    <option>CLEANUP_REFERENCE_CATALOGUE, boolean,  True</option>
    </term>
    <listitem>
    <para>If set True objects which do not have SExtractor`s FLAG equal 0 and
ELLIPTICITY_REFERENCE smaller  than e.g. 0.1 are removed from the reference catalog as well as
objects which are closer than OBJECT_SEPARATION. 
    </para>
    </listitem>
    </varlistentry>
      <varlistentry>
	<term><option>DS9_ALL, boolean, True</option>
         </term>
	<listitem><para>If DS9_MATCHED==True all objects SExtractor found are
displayed as red circles. The text presents the focuser position and the
reference number in SExtractor`s catalog file. The diameter is equal to 2 + 2 *  FWHM. To display
the
results execute the file with the postfix .bash in the temporary directory.</para>
        </listitem>
 </varlistentry> 

      <varlistentry>
	<term><option>DS9_MATCHED, boolean, True</option>
         </term>
	<listitem><para>All objects SExtractor matched are 
displayed as blue circles. If the displayed image is the reference file
these circles are yellow. The text presents the focuser position and the
reference number in SExtractor`s catalog file. The diameter is equal to 2 *  FWHM. To display the
results execute the file with the postfix .bash in the temporary directory. </para>
        </listitem>
 </varlistentry> 

      <varlistentry>
	<term><option>DS9_REFERENCE, boolean, True</option>
         </term>
	<listitem><para>All reference objects are displayed on each image as
green circles. The inner green circle is the FWHM while the outer is a guidance
presenting the reference number in SExtractor`s catalog file and the (x,y) coordinates.</para>
        </listitem>
 </varlistentry> 

     <varlistentry>
    <term>
    <option>DS9_REGION_FILE, base file name, "/tmp/ds9-rts2af.reg"</option>
    </term>
    <listitem>
    <para>These files can be loaded into DS9. See the options above and and
execute the file with the postfix .bash, e.g.  /tmp/ds9-rts2af-B-2009-11-13T18:22:07+0000.reg.bash.
    </para>
    </listitem>
    </varlistentry>

      <varlistentry>
	<term>
      <option>ELLIPTICITY, float, .1 </option>
          </term>
	<listitem>
	  <para> ELLIPTICITY defines the upper limit of the ellipticity of objects on all images (see ELLIPTICITY_REFERENCE). 
          </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>
      <option>ELLIPTICITY_REFERENCE, float, .1 </option>
          </term>
	<listitem>
	  <para> ELLIPTICITY_REFERENCE defines the upper limit of the ellipticity of objects in the reference catalog. If exposure times are short and/or the seeing is bad increase the value. Recommended interval [0.05...0.3]. 
          </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>
            <option>FILTERS, list of filters separated by colon, "I"</option>
          </term>
	<listitem>
	  <para>
FILTERS which being used for the focus run, are defined by the names of
filters in RTS2_DEVICES, or a subset of them. FILTERS must agree with 
those with CCD_CAMERA  associated filter wheel. If e.g. "U:B:V:R:I:X:Y" 
is specified in RTS2_DEVICES valid subsets are "U" or "V:I" etc.
           </para>
          </listitem>
        </varlistentry>
      <varlistentry>
	<term>
      <option>FITS_IN_BASE_DIRECTORY, boolean, False</option>
          </term>
	<listitem>
	  <para>
             If True the fits files are searched in directory BASE_DIRECTORY in offline mode. Setting
             this parameter to True enables the analysis of legacy data or data not acquired with <command>rts2af</command>.
          </para>
	</listitem>
      </varlistentry>


     <varlistentry>
    <term>
    <option>FIT_RESULT_FILE, base file name, "/tmp/fit-rts2af.dat"</option>
    </term>
    <listitem>
    <para>These files are the data files (FWHM, FLUX_MAX) which are fed into
fit program.
    </para>
    </listitem>
    </varlistentry>

      <varlistentry>
	<term>
      <option>FOCALLENGTH, float, [m]</option>
          </term>
	<listitem>
	  <para> ToDo: planned feature not yet there.
          </para>
	</listitem>
      </varlistentry>


   <varlistentry>
    <term>
    <option>FITPRG, path to the fit program,  "rts2af_fit.py"</option>
    </term>
    </varlistentry>

      <varlistentry>
	<term><option>FOCUSER_ABSOLUTE_LOWER_LIMIT, int, 0 [ticks]</option>
         </term>
	<listitem><para>No focuser position is set below this limit.</para>
        </listitem>
 </varlistentry> 

      <varlistentry>
    <term>
	<option>FOCUSER_ABSOLUTE_UPPER_LIMIT, int, 7000 [ticks]</option>
    </term>
         
	<listitem><para>No focuser position is set above this limit.</para>
        </listitem>
 </varlistentry> 


      <varlistentry>
	<term><option>FOCUSER_RESOLUTION, int, 20 [ticks]</option>
         </term>
	<listitem><para>This is the number of focuser 
ticks which makes a difference e.g. in FWHM.</para>
        </listitem>
 </varlistentry> 

    <varlistentry>
    <term>
    <option>MINIMUM_OBJECTS, int, 5</option>
    </term>
    <listitem>
    <para> This is the minimal number of objects which must be identified on all images.
    </para>
    </listitem>
    </varlistentry>

    <varlistentry>
    <term>
    <option>OBJECT_SEPARATION, int, 20 [pixel]</option>
    </term>
    <listitem>
    <para>If CLEANUP_REFERENCE_CATALOGUE==True only pairs of stars which have a
distance larger than OBJECT_SEPARATION are accepted as reference objects.
     </para>
    </listitem>
    </varlistentry>

      <varlistentry>
	<term>
      <option>REMOVE_TEMPORARY_FILES, boolean, to be defined</option>
          </term>
	<listitem>
	  <para> ToDo: planned feature not yet there.
          </para>
	</listitem>
      </varlistentry>
    <varlistentry>
    <term>
    <option>SET_FOCUS, boolean, False</option>
    </term>
    <listitem>
    <para> IF True and <command>rts2af</command> yields a valid fitted focuser
position this value is set.
    </para>
    </listitem>
    </varlistentry>

    <varlistentry>
    <term>
    <option>SEXCFG, file name, "/etc/rts2/rts2af/rts2af-sex.cfg"</option>
    </term>
    <listitem>
    <para>The SExtractor configuration file.
    </para>
     <para> If a relative path is specified it is relative to BASE_DIRECTORY.
     </para>
    </listitem>
    </varlistentry>

    <varlistentry>
    <term>
    <option>SEXPARAM, file name, "/etc/rts2/rts2af/rts2af-sex.param"</option>
    </term>
    <listitem>
    <para>The SExtractor parameter file for image analysis. This file
is identical with SEXREFERENCE_PARAM beside the last two entries VECTOR_ASSOC(14)
NUMBER_ASSOC.
    </para>
     <para> If a relative path is specified it is relative to BASE_DIRECTORY.
     </para>

    </listitem>
    </varlistentry>
    <varlistentry>
    <term>
    <option>SEXPRG, file name, "sex 2>/dev/null"</option>
    </term>
    <listitem>
    <para>The SExtractor path.
    </para>
    </listitem>
    </varlistentry>


    <varlistentry>
    <term>
    <option>SEXREFERENCE_PARAM, file name, "/etc/rts2/rts2af/rts2af-sex-reference.param"</option>
    </term>
    <listitem>
    <para>The SExtractor parameter file for image analysis. 
    </para>
     <para> If a relative path is specified it is relative to BASE_DIRECTORY.
     </para>

    </listitem>
    </varlistentry>

     <varlistentry>
    <term>
    <option>SEXSKY_LIST, base file name, "/tmp/sex-rts2af-assoc-sky.list"</option>
    </term>
    <listitem>
    <para>This is SExtractor`s reference catalog.
    </para>
    </listitem>
    </varlistentry>
    <varlistentry>
    <term>
    <option>TEST_ACQUIRE, boolean, False</option>
    </term>
    <listitem>
    <para> If True <command>rts2af_acquire.py</command> uses
<command>rts2af_feedback_acquire.py</command> instead of
<command>rts2af_analysis.py</command>. <command>rts2af_feedback_acquire.py</command>
is used for daytime testing with no real images (see
rts2/scritps/rts2af/README). In case the images described in README are
present, then these are fed to <command>rts2af_analysis.py</command> and the
whole chain is tested.
    </para>
    </listitem>
    </varlistentry>
    <varlistentry>
    <term>
    <option>TAKE_PROOF, boolean, True</option>
    </term>
    <listitem>
    <para> If True <command>rts2af</command> takes a proof image at fitted focus position.
    </para>
    </listitem>
    </varlistentry>

      <varlistentry>
	<term>
      <option>ToDo: VARIABLE_FOCUSER_STEPS, boolean, to be defined</option>
          </term>
	<listitem>
	  <para> ToDo: planned feature not yet there.
          </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>
      <option>VARIABLE_EXPOSURE_TIME, boolean, True</option>
          </term>
	<listitem>
	  <para> Currently a linear model is used (no choice yet)</para>
	  <para> If True the exposure time depend on relative focus position.
          </para>
	</listitem>
      </varlistentry>
  </refsect1>
  <refsect1>
    <title>Hints</title>
<para>
A focus run may fail due to various reasons. The more images
are taken, specially far off the extreme, the fewer objects
are present on all images. Although a sensible result can be
obtained with a single object it is recommended to have a reasonable
number spread over the whole image. 
Choose narrower lower and upper limits around the extreme. 
One can define sensible limits visually inspecting the DS9 region files (see option DS9_REGION_FILE).
</para>
<para>
If a star field is crowded that means many pairs of stars are within
OBJECT_SEPARATION it may happen that only one object survives the cleaning
process. Try to reduce OBJECT_SEPARATION 
to avoid overlaps of star images. If it still fails use
CLEANUP_REFERENCE_CATALOGUE = False - but inspect then the images visually to
gain confidence. 
</para>
<para>
If too few objects are present vary SExtractor`s DETECT_THRESH
or choose a field where more stars are present or increase
exposure time during online data taking. Do not set a ELLIPTICITY value
above 0.3.
<para>
</para>
If the focus images are taken with an unguided telescope the center
of the image may be shifted in the RA direction due to e.g. the periodic error of
the worm gear. A shift in DEC may occur due to the
    atmospheric refraction and/or polar alignment. If images are not considered try to adjust
 SExtractor`s ASSOC_RADIUS. Be cautious: do not make the value
too large, since SExtractor will not match better.
</para>
<para>
The result may degrade if the atmospheric conditions
change during data taking. Therefore try to minimize
the exposure time. 
</para>
  </refsect1>
<refsect1>
<title>SExtractor configuration</title>
<para> 
You must choose rts2af-sex.cfg,  rts2af-sex.param,  rts2af-sex-reference.param
from subdirectory conf/rts2af/sex. Compared with the default rts2af-sex.cfg (see sextractor -dd) the following
parameters have been changed:</para>
<variablelist>   
<varlistentry><variablelist> <varlistentry><term>DETECT_THRESH    1.7
         </term>
	<listitem><para>#  sigmas or threshold, ZP in mag.arcsec-2</para>
        </listitem>
 </varlistentry> 
      <varlistentry>
	<term>ANALYSIS_THRESH  1.7
         </term>
	<listitem><para># sigmas or threshold, ZP in mag.arcsec-2</para>
        </listitem>
 </varlistentry> 
      <varlistentry>
	<term>FILTER           N
         </term>
	<listitem><para># apply filter for detection (Y or N)? (This feature is as of 2012-07-07 under consideration)</para>
        </listitem></varlistentry>
      <varlistentry>
	<term>ASSOC_DATA       0 
         </term> 
	<listitem><para># columns of the data to replicate (0=all) # rts2-atofocus DO not touch
        </para>
        </listitem>
 </varlistentry> 
      <varlistentry>
	<term>ASSOC_PARAMS     2,3
         </term>
	<listitem><para># columns of xpos,ypos[,mag] # rts2af do not use mag</para>
        </listitem>
 </varlistentry> 
      <varlistentry>
	<term>ASSOC_RADIUS     10.0
         </term>
	<listitem><para># cross-matching radius (pixels) 
        </para>
        </listitem>
      </varlistentry> 
 </variablelist> 
      </varlistentry> 
 </variablelist> 
<para> 
Do not change parameters which affect the output format.
</para> 
<para> 
The following parameters of rts2af-sex.cfg will be overwritten:  
  </para>
<variablelist>
      <varlistentry>
<variablelist>
      <varlistentry>
	<term>CATALOG_NAME     sex-flux.cat
         </term>
	<listitem><para># overwritten by rts2af, name of the output catalog (.cat)</para>
<para>The base name is SEXCATALOGUE (.cat)</para>        </listitem>
 </varlistentry> 

      <varlistentry>
	<term>PARAMETERS_NAME  sex-flux.param 
         </term>
	<listitem><para># name of the file containing catalog contents
</para><para>The base name is SEXPARAM or for the reference catalog
SEXREFERENCE_PARAM (.param)</para>
        </listitem>
 </varlistentry> 

      <varlistentry>
	<term>ASSOC_NAME       sex-flux-sky.list
         </term>
	<listitem><para># overwritten by rts2af, name of the ASCII file
to ASSOCiate</para><para>The base name is SEXSKY_LIST (.list)</para>
        </listitem>
 </varlistentry> 
</variablelist>
 </varlistentry> 
</variablelist>
</refsect1>
<refsect1>
<title>Image location</title>
 <para>
 In online mode <command>rts2af</command> stores the acquired images below BASE_DIRECTORY/date-time/filter.
 </para>
</refsect1>
  <refsect1>
    <title>Files</title><para>Examples of the mandatory configuration files are found in the RTS2 svn
repository. Best copy  ./conf/rts2af  to /etc/rts2/</para>
   <para>rts2af-sex.cfg </para>
  <para>rts2af-sex.param, rts2af-sex-reference.param 
  </para>
    <para>rts2af-acquire.cfg,  rts2af-fwhm.cfg</para>
  </refsect1>
  <refsect1>
    <title>SEE ALSO</title>
    <para>
     http://rts2.org/wiki,
https://azug.minpet.unibas.ch/wikiobsvermes/index.php
    </para>
  </refsect1>
  <refsect1>
    <title>Installation and Testing</title>
    <para>
      See files rts2/scripts/rts2af/README and rts2/scripts/rts2af/test/focus/README.
    </para>
  </refsect1>
  <refsect1>
    <title>BUGS</title>
    <para>
      Please contact the author.
    </para>
    <para>
      Many temporary files are written. Remove them as necessary.
    </para>
  </refsect1>
</refentry>
