<html>
<head>
  <title>Test page</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta http-equiv="content-language" content="en">
  <meta name="author" content="Petr Kubanek (petr@kubanek.net)">
</head>

<script language="JavaScript" src="js/setgetapi.js" type="text/javascript"></script>
<script language='JavaScript'>
// find target of given name(s)
function searchTarget(text, opt, schedb)
{
	function fillTargets(targets)
	{
		opt.length = 0;
		for (i in targets.d)
		{
			var newTarget = document.createElement('option');
			newTarget.value = targets.d[i][0];
			newTarget.text = targets.d[i][1];

			opt.add(newTarget, null);
		}
		if (opt.length > 0)
		{
			schedb.disabled = false;
		}
		else
		{
			schedb.disabled = true;
		}
	}
	jsonCall(encodeURI('api/tbyname?n=' + text), fillTargets);
}

// schedule target
function schedule(tid)
{
	if (tid.options.length == 0)
	{
		alert('You have to search for targets');
	}
	if (tid.selectedIndex == undefined)
	{
		alert('You have to select target from available targets');
	}
	function scheduled(schedule)
	{
		alert('Scheduled with ID ' + schedule.schedule_id);
	}
	jsonCall(encodeURI('api/schedule_all?tar_id=' + tid.options[tid.selectedIndex].value), scheduled);
}

</script>

<body>
  <form name='target'>
    <input type='text' name='target'/>
    <select name='available'></select>
    <button type='button' onClick='searchTarget(this.form.target.value, this.form.available, this.form.schedb);'>Search</button>
    <button name='schedb' type='button' onClick='schedule(this.form.available);' disabled>Schedule</button>
  </form>
</body>
