\section{Server}

\subsubsection{Správa vláken}

Pro vykonávání funkcí, které trvají del¹í dobu, se na serveru pou¾ívají
vlákna. V devser jsou k dispozici funkce pro jejich zprávu.

\subsection{Pøenos dat}

Nabízejí se dvì mo¾nosti - snímky pøená¹et po stejném spojení, jako je
øídící, nebo pro pøenos snímkù vytváøet nové spojení. Mo¾nost
vytváøet nové spojení se je¹tì rozpadá na nìkolik variant podle toho, jak
podobné spojení navazovat, pou¾ívat, udr¾ovat a ukonèovat.

\subsubsection{Varianta jedno spojení}

Na spojení po¹le server po po¾adavku klienta data. Data budou zakonèena
speciální hodnotou, o které bude známo, ¾e se jinde ne¾ na konci pøenosu
nevyskytuje. Pøípadnì server vy¹le na zaèátku spojení informaci o velikosti
pøená¹ených dat. Tím bude zaruèeno, ¾e klient pozná, kdy data skonèily, a
pøepne se zpìt do re¾imu pøijímajícím odpovìdi. Dal¹í mo¾ností je vyhradit
èást dat pro stavové informace - napøíklad do ka¾dého n-tého bitu napsat
jednièku nebo 0 podle toho, jestli spojení skonèilo nebo ne. Na re¾ii spojení
pak padne 1/n-tina kapacity spojení.

\begin{itemize}
\item{Výhody}
	\begin{itemize}
	\item jednoduché na implementaci, jak na klientovi, tak na serveru
	\item nenároèné
	\end{itemize}
\item{Nevýhody}
	\begin{itemize}
	\item na jednom spojení nelze souèasnì vyèítat data a posílat odpovìdi na
	  stav zaøízení
	\item míchání textových a binárních dat mù¾e vést ke zbyteèným problémùm
	  pro øízení pøenosu
	\end{itemize}
\end{itemize}

\subsubsection{Varianta øídící a datové spojení}

Na øídícím spojení po¹lu pøíkaz, který má data posílat. Jedna ze stran otevøe
datové spojení, druhá se k~nìmu pøipojí. Po navázání datového spojení ukonèím
úspì¹nì volání s~po¾adavkem na data, od tohoto okam¾iku mohu øídící spojení
znovu vyu¾ívat pro posílání dal¹ích pøíkazù. Na datové spojení zaène server
psát data, které klient vyèítá. Po poslání v¹ech dat datové spojení ukonèím.

\begin{itemize}
\item{Výhody}
	\begin{itemize}
	\item mo¾nost souèasnì ovládat zaøízení a pøijímat data
	\end{itemize}
\item{Nevýhody}
	\begin{itemize}
	\item nároèné na implementaci
	\end{itemize}
\end{itemize}

Rozhodl jsem se pro samostatné datové spojení, rozhodujícím faktorem byla
mo¾nost posílat souèasnì data a ovládat zaøízení.

Pøi vlastní implementaci jsem se inspiroval protokolem FTP, popsaném v
\cite{RFC959}.

\subsection{Realizace}

Ka¾dý server pøi startu èeká na spojení na TCP portu, na kterém je
pøipojen. Pokud takový po¾adavek pøijde, forkne se, PID potomka
zaznamená pro pozdìj¹í pou¾ití, a potomka zinicializuje. Potomek pak
musí obslou¾it v¹echny do¹lé po¾adavky.

Výhod tohoto øe¹ení je nìkolik:

\begin{itemize}
\item dostanu zadarmo nový, zinicializovaný adresový prostor
\item nemohu zasahovat do adresového prostoru ostatních spojení
\item pøípadnými chybami neovlivním ostatní spojení
\end{itemize}

Pøi jeho realizaci je tøeba zajistit komunikaci mezi centrálním
serverem a procesy obsluhujícími spojení. Mo¾nosti, které se nabízejí:

\begin{itemize}
\item vytvoøit nové spojení na centrální server
\item pou¾ít pro komunikaci s centrálním serverem rodièovský proces, a
zajistit komunikaci s rodièovským procesem
\end{itemize}

První mo¾nost je dost nevýhodná vzhledem k velkému mno¾ství dal¹ích
spojení, které bude tøeba vytváøet a udr¾ovat v chodu - ka¾dé
spojení na zaøízení znamená jedno spojení na zaøízení. Tedy,
konkrétnìji, pokud budu mít k klientù a z zaøízení, budu vytváøet k*z
spojení.

Druhé øe¹ení je pouze odsunutí problému o krok dále. Ale staèí mì v
nìm zajistit komunikaci mezi rodièovským procesem a jeho potomky.  Co¾ není
zase tak velký problém, na jeho vyøe¹ení se nabízí hned nìkolik metod:

\begin{itemize}
\item prostøedky IPC
\item obousmìrné roury
\item unixové sokety
\item TCP/IP sokety
\end{itemize}

TCP/IP sokety jsou uvedeny pouze pro úplnost. Vytváøení a udr¾ování tohoto
typu spojení vy¾aduje nejvíce systémových prostøedkù, je výhodné pro
komunikaci pøes sí», ale je zbyteèné pro komunikaci v rámci jednoho poèítaèe.

Prostøedky IPC vypadají nejlépe. Pomocí rozli¹ení pøes typ zprávy umo¾òují
doruèení zprávy pouze vybranému pøíjemci. Sdílená pamì» mù¾e slou¾it pro
ukládání informací, ke kterým potøebují pøistupovat jednotlivá spojení -
napøíklad o stavu zaøízení. IPC semafory lze pou¾ít na hlídání kritické sekce
- zápisu do sdílené pamìti.

\subsection{Logování}

Servery logují informace pomocí syslogu. Rotace jejich logù je zaji¹tìna
utilitou logrotate.

\subsection{Modularita}

Ovladaèe jednotlivých zaøízení jsou psány jako knihovny, které se pøi pøekladu
slinkují s kódem serveru zaøízení.

Jinou mo¾ností zaji¹tìní modularity je napsání ovladaèù zaøízení a jejich
pou¾ití. Vzhledem k nároènosti této mo¾nosti a nedostatku èasu k její
realizaci nedo¹lo.

\subsection{U¾ivatelské rozhraní}

U¾ivatelé mohou ovládat dalekohled prostøednictvím monitorovacího programu.
Ten bì¾í pod konzolí.

Grafické u¾ivatelské rozhraní je pro monitoring dalekohledu zbyteèné. Pro
výbìr snímkù z databáze slou¾í webové rozhraní.

Pro prohlí¾ení snímkù staèí z Internetu stáhnout libovolný prohlí¾eè. Rozsah
funkcí, kterými souèasné prohlí¾eèe CCD snímkù disponují by se mì v rámci
diplomové práce nepodaøilo nikdy implementovat. Z prohlí¾eèù se nám osvìdèila
DS9, pøípadnì evropský SkyCat.

Prohlí¾eè DS9 vyniká rozhraním XPA a propojením s balíkem pro zpracování
snímkù \cite{IRAF}.

SkyCat nabízí o trochu pøíjemnìj¹í ovládání, a hlavnì mo¾nost pøekreslit pøes
snímek pozice hvìzdných a jiných objektù uvedených v katalozích.
